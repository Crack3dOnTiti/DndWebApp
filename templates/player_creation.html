<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Création de Personnage - D&D Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #e0e0e0;
            height: 100vh;
            overflow: hidden;
            padding: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .container {
            max-width: 1300px;
            width: 95%;
            background: #2a2a2a;
            border-radius: 12px;
            padding: 45px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            border: 1px solid #3a3a3a;
            height: 85vh;
            display: flex;
            flex-direction: column;
        }

        .title {
            text-align: center;
            font-size: 2.3rem;
            font-weight: 700;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #ff4444, #cc3333);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            text-align: center;
            color: #999;
            margin-bottom: 35px;
            font-size: 1rem;
        }

        .form-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 50px;
            flex: 1;
        }

        .left-section {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .right-section {
            display: flex;
            flex-direction: column;
        }

        .form-section {
            display: flex;
            flex-direction: column;
        }

        .section-title {
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 18px;
            color: #f0f0f0;
        }

        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 18px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            margin-bottom: 6px;
            color: #ccc;
            font-size: 1rem;
            font-weight: 500;
        }

        .input-group input, .input-group select, .input-group textarea {
            padding: 12px;
            background: #1a1a1a;
            border: 1px solid #444;
            border-radius: 6px;
            color: #e0e0e0;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus, .input-group select:focus, .input-group textarea:focus {
            outline: none;
            border-color: #ff4444;
        }

        .textarea-group {
            grid-column: 1 / -1;
        }

        .textarea-group textarea {
            min-height: 140px;
            resize: vertical;
        }

        .background-section {
            margin-bottom: 20px;
        }

        .background-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }

        .background-btn {
            padding: 12px;
            background: #1a1a1a;
            border: 2px solid #444;
            border-radius: 8px;
            color: #ccc;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .background-btn:hover {
            border-color: #666;
            background: #252525;
        }

        .background-btn.selected {
            border-color: #ff4444;
            background: rgba(255, 68, 68, 0.1);
            color: #ff6666;
        }

        .background-description {
            padding: 20px;
            background: #1a1a1a;
            border-radius: 6px;
            border-left: 3px solid #ff4444;
            min-height: 180px;
            display: none;
        }

        .background-description.active {
            display: block;
        }

        .description-title {
            font-weight: 600;
            color: #ff6666;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .description-text {
            color: #ccc;
            margin-bottom: 15px;
            line-height: 1.5;
            font-size: 0.9rem;
        }

        .stat-modifiers {
            font-size: 0.85rem;
            color: #aaa;
        }

        .stat-modifiers strong {
            color: #ff6666;
        }

        .btn-container {
            text-align: center;
            margin-top: auto;
            padding-top: 20px;
        }

        .btn {
            padding: 16px 50px;
            background: linear-gradient(135deg, #ff4444, #cc3333);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0.5;
            pointer-events: none;
        }

        .btn.enabled {
            opacity: 1;
            pointer-events: auto;
        }

        .btn.enabled:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 68, 68, 0.3);
        }

        .required-indicator {
            color: #ff4444;
            margin-left: 3px;
        }

        .validation-message {
            text-align: center;
            color: #ff6666;
            margin-top: 12px;
            font-size: 0.85rem;
        }

        .empty-description {
            padding: 20px;
            background: #1a1a1a;
            border-radius: 6px;
            border-left: 3px solid #444;
            min-height: 180px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="title">Création de Personnage</h1>
        <p class="subtitle">Remplissez tous les champs pour créer votre personnage</p>

        <form id="characterForm">
            <div class="form-container">
                <!-- Left Section -->
                <div class="left-section">
                    <!-- Basic Info -->
                    <div class="form-section">
                        <h2 class="section-title">Informations de Base</h2>
                        <div class="input-row">
                            <div class="input-group">
                                <label for="name">Prénom <span class="required-indicator">*</span></label>
                                <input type="text" id="name" name="name" required>
                            </div>
                            <div class="input-group">
                                <label for="gender">Sexe <span class="required-indicator">*</span></label>
                                <select id="gender" name="gender" required>
                                    <option value="">Sélectionner</option>
                                    <option value="Homme">Homme</option>
                                    <option value="Femme">Femme</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Powers -->
                    <div class="form-section">
                        <h2 class="section-title">Pouvoir</h2>
                        <div class="input-row">
                            <div class="input-group">
                                <label for="skillName">Nom du Pouvoir <span class="required-indicator">*</span></label>
                                <input type="text" id="skillName" name="skillName" required>
                            </div>
                        </div>
                        <div class="input-row">
                            <div class="input-group textarea-group">
                                <label for="skillDescription">Description du Pouvoir <span class="required-indicator">*</span></label>
                                <textarea id="skillDescription" name="skillDescription" placeholder="Décrivez les effets et l'utilisation de ce pouvoir..." required></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Section -->
                <div class="right-section">
                    <div class="background-section">
                        <h2 class="section-title">Origine <span class="required-indicator">*</span></h2>
                        
                        <div class="background-options">
                            <div class="background-btn" data-background="vif">Vif</div>
                            <div class="background-btn" data-background="martial">Martial</div>
                            <div class="background-btn" data-background="hommedefoie">Homme de Foie</div>
                            <div class="background-btn" data-background="mediateur">Médiateur</div>
                        </div>

                        <div class="empty-description" id="emptyDescription">
                            Sélectionnez une origine pour voir sa description
                        </div>

                        <div id="desc-vif" class="background-description">
                            <div class="description-title">Vif</div>
                            <div class="description-text">Durant votre formation au camp d'entraînement, vous avez été poussé à privilégier la vitesse et l'agilité. Les instructeurs vous ont enseigné que la mobilité était la clé de la survie, sacrifiant la force brute pour une rapidité exceptionnelle et une endurance accrue.</div>
                            <div class="stat-modifiers"><strong>Modificateurs:</strong> STR -15, SPD +10, STM +10, MNY x1</div>
                        </div>

                        <div id="desc-martial" class="background-description">
                            <div class="description-title">Martial</div>
                            <div class="description-text">Votre entraînement s'est concentré sur le développement de votre force physique. Les instructeurs vous ont formé comme un bélier humain, capable de briser n'importe quelle défense par la force pure, même si cela compromet votre agilité.</div>
                            <div class="stat-modifiers"><strong>Modificateurs:</strong> STR +20, SPD -5, MNY x1.2</div>
                        </div>

                        <div id="desc-hommedefoie" class="background-description">
                            <div class="description-title">Homme de Foie</div>
                            <div class="description-text">Au camp, vous avez été dirigé vers un entraînement spécialisé, développant vos compétences techniques et votre endurance mentale. Cette formation intensive a renforcé votre stamina mais a négligé le développement physique général.</div>
                            <div class="stat-modifiers"><strong>Modificateurs:</strong> STR -10, SPD -5, STM +20, MNY x0.8</div>
                        </div>

                        <div id="desc-mediateur" class="background-description">
                            <div class="description-title">Médiateur</div>
                            <div class="description-text">Votre formation a été équilibrée dans tous les domaines. Les instructeurs ont reconnu votre potentiel polyvalent et vous ont enseigné à être adaptable en toutes circonstances, développant votre instinct et votre chance naturelle.</div>
                            <div class="stat-modifiers"><strong>Modificateurs:</strong> LUK +5, MNY x1.5</div>
                        </div>

                        <input type="hidden" id="starterBackground" name="starterBackground" required>
                    </div>

                    <div class="btn-container">
                        <button type="submit" id="createBtn" class="btn">Créer le Personnage</button>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <script>
        const form = document.getElementById('characterForm');
        const createBtn = document.getElementById('createBtn');
        const backgroundBtns = document.querySelectorAll('.background-btn');
        const backgroundDescriptions = document.querySelectorAll('.background-description');
        const emptyDescription = document.getElementById('emptyDescription');
        const starterBackgroundInput = document.getElementById('starterBackground');

        // Handle background selection
        backgroundBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                // Remove selected class from all buttons
                backgroundBtns.forEach(b => b.classList.remove('selected'));
                
                // Add selected class to clicked button
                btn.classList.add('selected');
                
                // Hide empty description and all descriptions
                emptyDescription.style.display = 'none';
                backgroundDescriptions.forEach(desc => desc.classList.remove('active'));
                
                // Show selected description
                const background = btn.dataset.background;
                document.getElementById(`desc-${background}`).classList.add('active');
                
                // Set hidden input value
                starterBackgroundInput.value = background;
                
                // Check form validity
                checkFormValidity();
            });
        });

        // Check form validity on input
        form.addEventListener('input', checkFormValidity);
        form.addEventListener('change', checkFormValidity);

        function checkFormValidity() {
            const requiredFields = form.querySelectorAll('[required]');
            let allFilled = true;

            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    allFilled = false;
                }
            });

            if (allFilled) {
                createBtn.classList.add('enabled');
            } else {
                createBtn.classList.remove('enabled');
            }
        }

        // Form submission
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!createBtn.classList.contains('enabled')) {
                return;
            }

            const formData = new FormData(form);
            const characterData = {
                name: formData.get('name'),
                gender: formData.get('gender'),
                skill_name: formData.get('skillName'),
                skill_description: formData.get('skillDescription'),
                starter_background: formData.get('starterBackground')
            };

            try {
                const response = await fetch('/api/players', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(characterData)
                });

                if (response.ok) {
                    const result = await response.json();
                    // Redirect to player dashboard
                    window.location.href = `/player-dashboard/${result.id}`;
                } else {
                    const error = await response.json();
                    alert('Erreur lors de la création: ' + (error.message || 'Erreur inconnue'));
                }
            } catch (error) {
                alert('Erreur de connexion: ' + error.message);
            }
        });

        // Initial validity check
        checkFormValidity();
    </script>
</body>
</html>